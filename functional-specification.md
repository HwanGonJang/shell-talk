# **ShellTalk 기능 명세서**

## **1. 프로젝트 개요**

Go 언어를 사용하여 터미널 기반 클라이언트가 접속할 수 있는 **안정적이고 확장 가능한** 채팅 서버 **ShellTalk**을 구현한다. 사용자는 채팅방을 생성, 조회, 참여 및 퇴장할 수 있으며, 참여한 채팅방 내에서 공개 메시지 및 개인 메시지(DM)를 주고받을 수 있다.

---

## **2. 핵심 기능 정의**

### **2.1. 채팅방 관리**

#### **2.1.1. 채팅방 생성**
- **설명**: 사용자가 새로운 채팅방을 생성한다.
- **요청 파라미터**:
    - `name` (문자열, 필수): 생성할 채팅방의 이름.
    - `password` (문자열, 선택): 채팅방 입장을 위한 비밀번호.
- **처리 과정**:
    1. 고유 ID를 가진 새로운 채팅방을 생성하고, 요청한 사용자를 첫 번째 참여자로 등록한다.
    2. 생성 성공 또는 실패 결과를 응답한다.
- **실패 조건**: 이미 동일한 이름의 채팅방이 존재하는 경우.

#### **2.1.2. 채팅방 목록 조회**
- **설명**: 현재 서버에 활성화된 모든 채팅방의 목록을 조회한다.
- **처리 과정**:
    1. 각 채팅방의 정보(**ID, 이름, 비밀번호 존재 여부, 현재 참여 인원 수**)를 응답한다.

#### **2.1.3. 채팅방 참여**
- **설명**: 사용자가 특정 채팅방에 참여한다.
- **요청 파라미터**:
    - `roomId` (문자열/ID, 필수): 참여할 채팅방의 고유 ID.
    - `nickname` (문자열, 필수): 채팅방에서 사용할 닉네임.
    - `password` (문자열, 선택): 비밀방의 경우 필요한 비밀번호.
- **처리 과정**:
    1. `roomId`와 `password` 유효성을 검증한다.
    2. 인증 성공 시, 사용자의 웹소켓 연결을 수립하고 채팅방(Hub)에 클라이언트로 등록한다.
    3. `[SYSTEM] 'nickname'님이 입장하셨습니다.` 와 같은 시스템 메시지를 해당 방의 모든 참여자에게 전송한다.
    4. **(추가)** 참여자에게 **최근 채팅 내역(예: 최근 10개)을 전송**하여 대화의 맥락을 파악할 수 있게 한다.
- **실패 조건**: 존재하지 않는 방, 틀린 비밀번호, 중복된 닉네임.

#### **2.1.4. 채팅방 퇴장**
- **설명**: 사용자가 참여하고 있는 채팅방에서 나간다.
- **처리 과정**:
    1. 사용자의 클라이언트를 채팅방(Hub)에서 등록 해제한다.
    2. 웹소켓 연결을 정상적으로 종료한다.
    3. `[SYSTEM] 'nickname'님이 퇴장하셨습니다.` 시스템 메시지를 남은 참여자들에게 전송한다.
    4. **(추가)** 만약 마지막 참여자가 퇴장한 경우, 해당 채팅방을 **자동으로 삭제**하여 리소스를 정리한다.

### **2.2. 실시간 채팅 및 상호작용**

#### **2.2.1. 공개 메시지 전송 및 수신**
- **설명**: 채팅방에 참여한 사용자가 해당 방의 모든 참여자에게 메시지를 보낸다(Broadcast).
- **메시지 형식**: `[닉네임]: 메시지 내용`

#### **2.2.2. 참여자 목록 조회**
- **설명**: 현재 접속한 채팅방의 사용자 목록을 확인한다.
- **처리 과정**: 클라이언트가 특정 명령어(예: `/users`)를 입력하면, 서버는 현재 방에 있는 모든 사용자의 닉네임 목록을 응답한다.

#### **2.2.3. 개인 메시지(DM) 전송**
- **설명**: 채팅방 내의 특정 사용자에게만 보이는 1:1 메시지를 보낸다.
- **요청 파라미터**:
    - `recipientNickname` (문자열, 필수): 메시지를 받을 상대방의 닉네임.
    - `message` (문자열, 필수): 전송할 메시지 내용.
- **처리 과정**:
    1. 서버는 메시지를 수신하면 `recipientNickname`을 가진 클라이언트를 찾아 해당 클라이언트에게만 메시지를 전송한다.
    2. 메시지를 보낸 사람에게도 확인 메시지를 전송한다.
- **메시지 형식**:
    - 받는 사람: `[DM from 닉네임]: 메시지 내용`
    - 보낸 사람: `[DM to 상대방 닉네임]: 메시지 내용`
- **실패 조건**: 해당 닉네임의 사용자가 방에 존재하지 않을 경우.

---

### **3. 클라이언트 명령어**

터미널 클라이언트의 사용성을 높이기 위해 다음과 같은 명령어를 지원한다.

| 명령어 | 기능 | 설명 |
| :--- | :--- | :--- |
| `/help` | 도움말 | 사용 가능한 모든 명령어 목록을 보여줍니다. |
| `/users` | 참여자 목록 | 현재 채팅방에 참여 중인 모든 사용자의 닉네임을 보여줍니다. |
| `/dm [닉네임] [메시지]` | 개인 메시지 | 특정 사용자에게 개인 메시지를 보냅니다. |
| `/quit` | 채팅방 퇴장 | 현재 참여 중인 채팅방에서 나갑니다. |

---

### **4. 데이터 모델 (Entity)**

#### **4.1. 채팅방 (Room)**

| 필드명 | 타입 | 설명 |
| :--- | :--- | :--- |
| `id` | string | 채팅방 고유 ID |
| `name` | string | 채팅방 이름 (Unique) |
| ... | ... | ... |
| `history` | `[]Message` | 최근 메시지 보관을 위한 버퍼 (e.g., Ring Buffer) |

#### **4.2. 메시지 (Message)**

| 필드명 | 타입 | 설명 |
| :--- | :--- | :--- |
| `type` | `MessageType` | 메시지 타입 (`PUBLIC`, `DM`, `SYSTEM`) |
| `sender` | string | 보낸 사람 닉네임 (`SYSTEM` 타입일 경우 비어있음) |
| `recipient` | string | 받는 사람 닉네임 (`DM` 타입일 경우 사용) |
| `content` | string | 메시지 내용 |
| `timestamp` | datetime | 메시지 전송 시각 |

---

### **5. 비기능적 요구사항**

- **로그(Log) 기록**: 서버의 주요 이벤트(서버 시작/종료, 사용자 접속/이탈, 에러 발생)에 대한 로그를 Amazon CloudWatch로 기록하여 디버깅 및 추적을 용이하게 한다.
- **에러 처리**: 클라이언트의 잘못된 요청(예: 존재하지 않는 방 참여)에 대해 명확한 에러 메시지를 응답한다. 웹소켓 연결이 비정상적으로 끊겼을 때 서버가 안정적으로 이를 처리해야 한다.